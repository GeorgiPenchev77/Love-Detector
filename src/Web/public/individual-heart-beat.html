<!DOCTYPE html>
<html>
  <head>
    <title>Individual heartbeat</title>
    <link rel="icon" href="heart-png.webp" type="image/x-icon" />
    <link rel="stylesheet" href="css/individual-heart-beat-style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="heading-container">
      <h1>Measure your individual heartbeat! </h1>
        <h3>Each participant will now get their normal individual heartbeat measured. </h3>
    </div>
    <div class="middle-container">
      <div class="users">
        <div class="user-container" id="user1">
            <h2><span id="displayUserName1"></span> </h2>
            <p><span id="displayUserPronouns1"></span></p>
              <div class="instruction-container">
                <p>1: remove any accessories from your ear</p>
                <br>
                <p>2: attach the earklip to your earbud</p>
                <br>
                <p>3: Press the RIGHT button on the terminal to start the heartbeatsensor</p>
              </div>
              <button class="measure-button" onclick="displayMeasureMessage('user1')">Start on terminal button</button>
        </div>
        <div class="user-container" id="user2">
            <h2><span id="displayUserName2"></span></h2>
            <p><span id="displayUserPronouns2"></span></p>
            <div class="instruction-container">
              <p>1: remove any accessories from your ear</p>
              <br>
              <p>2: attach the earklip to your earbud</p>
              <br>
              <p>3: Press the RIGHT button on the terminal to start the heartbeatsensor</p>
            </div>
            <button class="measure-button" onclick="displayMeasureMessage('user2')">Start on terminal button</button>
        </div>
        <div class="nextUserButton-container">
          <button id="nextUserButton">Next User</button>
        </div>
      </div>
    </div>
    <div class="navigationButton-container">
      <button type="button" class="back-button" onclick="goBack()">Back</button>
      <a class="arrow-button" href="./startdatepage.html">
        <img src="Arrow-right-512.png" alt="Arrow-right" height="50" />
      </a>
    </div>
  </body>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>


    // Retrieve user info from previous page
    var userName1 = sessionStorage.getItem("userName1");
    var userPronouns1 = sessionStorage.getItem("userPronouns1");
    var userName2 = sessionStorage.getItem("userName2");
    var userPronouns2 = sessionStorage.getItem("userPronouns2");

    // Display user info on the page
    document.getElementById("displayUserName1").textContent = userName1;
    document.getElementById("displayUserPronouns1").textContent = userPronouns1;
    document.getElementById("displayUserName2").textContent = userName2;
    document.getElementById("displayUserPronouns2").textContent = userPronouns2;

    function goBack() {
      window.history.back();
    }
    
    //show only container with user 1 first.
    document.getElementById('user1').style.display = 'block';
    document.getElementById('user2').style.display = 'none';
    document.getElementById('nextUserButton').style.display = 'none';

    // Toggle visibility of user containers
    document.getElementById('nextUserButton').addEventListener('click', function() {
    document.getElementById('user1').style.display = 'none';
    document.getElementById('user2').style.display = 'block';
    document.getElementById('nextUserButton').style.display = 'none';
   
});

    const socket = io();

    socket.on('measuringMessage', function(data){
      console.log('Received measuringMessage event');
      displayMeasureMessage('user1');
    });
    
    /*function for displaying a waiting message while each user is measuring heartbeat,
     then after measurement is done, the users normal heartbeat is displayed. */
    function displayMeasureMessage(userId) {
      var userContainer = document.getElementById(userId);
      var messageParagraph = document.createElement('p');
      messageParagraph.textContent = "Measuring heartbeat..."; 
      messageParagraph.classList.add('message-text'); // Add a class for CSS to style the text
      userContainer.appendChild(messageParagraph);

      //hide the measureButton and the nextUserButton while the measuring process is running.  
      userContainer.querySelector('.measure-button').style.display = 'none';
      document.getElementById('nextUserButton').style.display = 'none';

      //hide the instructions while the measuring process is running. 
      var instructionContainer = userContainer.querySelector('.instruction-container');
      instructionContainer.style.display = 'none';

      // Display "Measuring heartbeat..." for 10 seconds, temporary function that will be replaced by the actual measuring!
      setTimeout(function() {
        messageParagraph.textContent = "Heartbeat: 75"; //this will be replaced with real data from broker!
        
        //put in the nextUserButton if only 1 user has been measured so far. 
        if (userId == 'user1'){
        document.getElementById('nextUserButton').style.display = 'block';
        }
      }, 5000); 
      
    }
  </script>
</html>
